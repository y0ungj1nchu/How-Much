CREATE SEQUENCE SEQ_PM START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_CATS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_SUB_CATS START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_FIXED_EXP START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_TX START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_BUDGETS START WITH 1 INCREMENT BY 1;

CREATE TABLE PAYMENT_METHODS (
    PM_ID           NUMBER              NOT NULL,
    NAME            VARCHAR2(50)        NOT NULL,
    TYPE            VARCHAR2(10)        NOT NULL,
    BALANCE         NUMBER              DEFAULT 0,
    BILLING_DAY     NUMBER              DEFAULT NULL,
    CONSTRAINT PK_PAYMENT_METHODS PRIMARY KEY (PM_ID)
);

CREATE TABLE CATEGORIES (
    CATEGORY_ID     NUMBER              NOT NULL,
    NAME            VARCHAR2(50)        NOT NULL,
    TYPE            VARCHAR2(10)        NOT NULL,
    CONSTRAINT PK_CATEGORIES PRIMARY KEY (CATEGORY_ID)
);

CREATE TABLE SUB_CATEGORIES (
    SUB_ID          NUMBER              NOT NULL,
    CATEGORY_ID     NUMBER              NOT NULL,
    NAME            VARCHAR2(50)        NOT NULL,
    CONSTRAINT PK_SUB_CATS PRIMARY KEY (SUB_ID),
    CONSTRAINT FK_SUB_CAT FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES(CATEGORY_ID)
);

CREATE TABLE BUDGETS (
    BUDGET_ID       NUMBER              NOT NULL,
    CATEGORY_ID     NUMBER              NOT NULL,
    YYYYMM          VARCHAR2(6)         NOT NULL, 
    AMOUNT          NUMBER              DEFAULT 0,
    CONSTRAINT PK_BUDGETS PRIMARY KEY (BUDGET_ID),
    CONSTRAINT FK_BUDGET_CAT FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES(CATEGORY_ID)
);

CREATE TABLE FIXED_EXPENSES (
    FIXED_EXP_ID    NUMBER              NOT NULL,
    SUB_ID          NUMBER              NOT NULL,
    PM_ID           NUMBER              NOT NULL,
    NAME            VARCHAR2(100)       NOT NULL,
    AMOUNT          NUMBER              NOT NULL,
    CYCLE_TYPE      VARCHAR2(10)        DEFAULT 'MONTHLY',
    CYCLE_DAY       NUMBER              NOT NULL,
    START_DATE      DATE                DEFAULT SYSDATE,
    END_DATE        DATE                DEFAULT NULL,
    CONSTRAINT PK_FIXED_EXP PRIMARY KEY (FIXED_EXP_ID),
    CONSTRAINT FK_FIXED_SUB FOREIGN KEY (SUB_ID) REFERENCES SUB_CATEGORIES(SUB_ID),
    CONSTRAINT FK_FIXED_PM FOREIGN KEY (PM_ID) REFERENCES PAYMENT_METHODS(PM_ID)
);

CREATE TABLE TRANSACTIONS (
    TX_ID           NUMBER              NOT NULL,
    PM_ID           NUMBER              NOT NULL,
    SUB_ID          NUMBER              NOT NULL,
    FIXED_EXP_ID    NUMBER              DEFAULT NULL,
    AMOUNT          NUMBER              NOT NULL,
    TX_DATE         DATE                DEFAULT SYSDATE NOT NULL,
    MEMO            VARCHAR2(200),
    CREATED_AT      DATE                DEFAULT SYSDATE,
    CONSTRAINT PK_TRANSACTIONS PRIMARY KEY (TX_ID),
    CONSTRAINT FK_TX_PM FOREIGN KEY (PM_ID) REFERENCES PAYMENT_METHODS(PM_ID),
    CONSTRAINT FK_TX_SUB FOREIGN KEY (SUB_ID) REFERENCES SUB_CATEGORIES(SUB_ID),
    CONSTRAINT FK_TX_FIXED FOREIGN KEY (FIXED_EXP_ID) REFERENCES FIXED_EXPENSES(FIXED_EXP_ID)
);

CREATE TABLE INSTALLMENTS (
    TX_ID           NUMBER              NOT NULL,
    TOTAL_MONTHS    NUMBER              NOT NULL,
    CURRENT_MONTH   NUMBER              NOT NULL,
    CONSTRAINT PK_INSTALLMENTS PRIMARY KEY (TX_ID),
    CONSTRAINT FK_INST_TX FOREIGN KEY (TX_ID) REFERENCES TRANSACTIONS(TX_ID) ON DELETE CASCADE
);

INSERT INTO PAYMENT_METHODS VALUES (1, '국민은행', 'BANK', 5000000, NULL);
INSERT INTO PAYMENT_METHODS VALUES (2, '현대카드', 'CARD', -450000, 25);
INSERT INTO PAYMENT_METHODS VALUES (3, '현금지갑', 'CASH', 30000, NULL);

INSERT INTO CATEGORIES VALUES (1, '식비', 'EXPENSE');
INSERT INTO CATEGORIES VALUES (2, '교통비', 'EXPENSE');
INSERT INTO CATEGORIES VALUES (3, '쇼핑', 'EXPENSE');
INSERT INTO CATEGORIES VALUES (4, '수입', 'INCOME');

INSERT INTO SUB_CATEGORIES VALUES (1, 1, '점심');
INSERT INTO SUB_CATEGORIES VALUES (2, 1, '저녁/회식');
INSERT INTO SUB_CATEGORIES VALUES (3, 1, '카페');
INSERT INTO SUB_CATEGORIES VALUES (4, 2, '택시');
INSERT INTO SUB_CATEGORIES VALUES (5, 2, '버스/지하철');
INSERT INTO SUB_CATEGORIES VALUES (6, 3, '전자기기');
INSERT INTO SUB_CATEGORIES VALUES (7, 3, '구독료');
INSERT INTO SUB_CATEGORIES VALUES (8, 4, '급여');
INSERT INTO SUB_CATEGORIES VALUES (9, 4, '용돈');

INSERT INTO BUDGETS VALUES (SEQ_BUDGETS.NEXTVAL, 1, '202511', 500000);
INSERT INTO BUDGETS VALUES (SEQ_BUDGETS.NEXTVAL, 2, '202511', 150000);
INSERT INTO BUDGETS VALUES (SEQ_BUDGETS.NEXTVAL, 3, '202511', 1000000);

INSERT INTO FIXED_EXPENSES VALUES (SEQ_FIXED_EXP.NEXTVAL, 7, 2, '넷플릭스', 17000, 'MONTHLY', 1, SYSDATE, NULL);

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 1, 8, NULL, 3000000, TO_DATE('2025-11-10 09:00', 'YYYY-MM-DD HH24:MI'), '11월 급여');

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 2, 1, NULL, 9000, TO_DATE('2025-11-11 12:30', 'YYYY-MM-DD HH24:MI'), '순대국밥');

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 2, 4, NULL, 15000, TO_DATE('2025-11-12 23:40', 'YYYY-MM-DD HH24:MI'), '야근 후 택시');

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 3, 3, NULL, 4500, TO_DATE('2025-11-13 13:00', 'YYYY-MM-DD HH24:MI'), '스타벅스');

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 2, 6, NULL, 1200000, TO_DATE('2025-11-15 15:00', 'YYYY-MM-DD HH24:MI'), '아이패드 구매');

INSERT INTO INSTALLMENTS (TX_ID, TOTAL_MONTHS, CURRENT_MONTH)
VALUES (SEQ_TX.CURRVAL, 3, 1);

INSERT INTO TRANSACTIONS (TX_ID, PM_ID, SUB_ID, FIXED_EXP_ID, AMOUNT, TX_DATE, MEMO)
VALUES (SEQ_TX.NEXTVAL, 2, 7, 1, 17000, TO_DATE('2025-11-01 10:00', 'YYYY-MM-DD HH24:MI'), '넷플릭스 자동결제');

COMMIT;